<UserControl x:Class="TechEquipments.Views.Param.AIParamView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
             xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
             xmlns:dxc="http://schemas.devexpress.com/winfx/2008/xaml/charts"
             xmlns:dxlc="http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"
             xmlns:dxch="clr-namespace:DevExpress.Xpf.Charts;assembly=DevExpress.Xpf.Charts.v21.2"
             xmlns:conv="clr-namespace:TechEquipments"
             MinHeight="260" MinWidth="520">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </UserControl.Resources>


    <dxlc:LayoutControl Margin="0">
        <dxlc:LayoutGroup Header="tryrtyr" View="Group" GroupBoxDisplayMode="Light">

            <!-- ================= LEFT BLOCK ================= -->
            <dxlc:LayoutGroup View="GroupBox" GroupBoxDisplayMode="Light" Width="180" HorizontalAlignment="Left">

                <dxlc:LayoutGroup Orientation="Vertical">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="20"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Grid.ColumnDefinitions >
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="30"/>
                            <ColumnDefinition Width="30"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- ProgressBar and scale - Left -->
                        <Grid Grid.Column="1" Grid.Row="1" x:Name="BarLeft">
                            <Border BorderBrush="Black" BorderThickness="1">
                                <dxe:ProgressBarEdit
                                    Value="{Binding Value, Mode=OneWay}" 
                                    Minimum="{Binding Min}"
                                    Maximum="{Binding Max}"
                                    ContentDisplayMode="Value" 
                                    DisplayFormatString="PLC value:    {0}"
                                    Orientation="Vertical"
                                    Width="30"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Stretch"
                                    ProgressBrush="DimGray"/>
                            </Border>
                        </Grid>

                        <Rectangle Grid.Column="0" Grid.Row="1" Height="1" Width="20" HorizontalAlignment="Right" VerticalAlignment="Top" Fill="Black" />
                        <TextBlock Grid.Column="0" Grid.Row="1" Margin="0,0,8,0" HorizontalAlignment="Right" VerticalAlignment="Top" Style="{StaticResource AppTextBlockStyle}" Text="{Binding Max}" />
                        <Rectangle Grid.Column="0" Grid.Row="1" Height="1" Width="10" HorizontalAlignment="Right" VerticalAlignment="Center" Fill="Black" />
                        <Rectangle Grid.Column="0" Grid.Row="1" Height="1" Width="20" HorizontalAlignment="Right" VerticalAlignment="Bottom" Fill="Black" />
                        <TextBlock Grid.Column="0" Grid.Row="1" Margin="0,0,8,0" HorizontalAlignment="Right" VerticalAlignment="Bottom" Style="{StaticResource AppTextBlockStyle}" Text="{Binding Min}" />

                        <!-- ProgressBar and scale - Right -->
                        <Grid Grid.Column="2" Grid.Row="1" x:Name="BarRight">
                            <Border BorderBrush="Black" BorderThickness="1">
                                <dxe:ProgressBarEdit
                                    Value="{Binding HmiTrue, Mode=OneWay}" 
                                    Minimum="{Binding MinR}"
                                    Maximum="{Binding MaxR}"
                                    ContentDisplayMode="Value" 
                                    DisplayFormatString="HmiTrue:   {0}"
                                    Orientation="Vertical"
                                    Width="30"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Stretch"
                                    ProgressBrush="ForestGreen"/>
                            </Border>
                        </Grid>

                        <Rectangle Grid.Column="3" Grid.Row="1" Height="1" Width="20" HorizontalAlignment="Left" VerticalAlignment="Top" Fill="Black" />
                        <TextBlock Grid.Column="3" Grid.Row="1" Margin="8,0,0,0" HorizontalAlignment="Left" VerticalAlignment="Top" Style="{StaticResource AppTextBlockStyle}" Text="{Binding MaxR}" />
                        <Rectangle Grid.Column="3" Grid.Row="1" Height="1" Width="10" HorizontalAlignment="Left" VerticalAlignment="Center" Fill="Black" />
                        <Rectangle Grid.Column="3" Grid.Row="1" Height="1" Width="20" HorizontalAlignment="Left" VerticalAlignment="Bottom" Fill="Black" />
                        <TextBlock Grid.Column="3" Grid.Row="1" Margin="8,0,0,0" HorizontalAlignment="Left" VerticalAlignment="Bottom" Style="{StaticResource AppTextBlockStyle}" Text="{Binding MinR}" />

                    </Grid>

                    <!-- Unit -->
                    <dxlc:LayoutGroup Header="LayoutGroup" View="Group">
                        <TextBlock Text="{Binding Unit}" VerticalAlignment="Bottom" HorizontalAlignment="Center" Style="{StaticResource AppTextBlockStyle}"/>
                    </dxlc:LayoutGroup>

                </dxlc:LayoutGroup>

            </dxlc:LayoutGroup>

            <!-- ================= CENTER BLOCK ================= -->
            <dxlc:LayoutGroup Orientation="Vertical" HorizontalAlignment="Stretch">

                <!-- ====== CHART (по умолчанию виден) ====== -->
                <dxlc:LayoutItem
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    Visibility="{Binding DataContext.IsParamChartVisible, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BoolToVis}}">

                    <!-- Trend chart (DevExpress WPF Charts).
                         IMPORTANT:
                         - VisualRange (AxisXMin/AxisXMax) = текущая видимая область.
                         - WholeRange  (AxisXWholeMin/AxisXWholeMax) = весь диапазон загруженных данных.
                           WholeRange должен быть шире VisualRange, чтобы работали scrollbars/пан.
                    -->
                    <dxc:ChartControl DataSource="{Binding DataContext.ParamTrendPoints, RelativeSource={RelativeSource AncestorType=Window}}"
                                      BoundDataChanged="ParamChart_BoundDataChanged"
                                      CustomDrawCrosshair="Chart_CustomDrawCrosshair">
                        <dxc:ChartControl.Diagram>
                            <dxc:XYDiagram2D
                                SeriesDataMember="Series"
                                EnableAxisXNavigation="True"
                                EnableAxisYNavigation="False"
                                Scroll="ParamChart_DiagramScroll"
                                Zoom="ParamChart_DiagramZoom">

                                <dxc:XYDiagram2D.NavigationOptions>
                                    <dxc:NavigationOptions UseMouse="True" UseScrollBars="True" UseKeyboard="True"/>
                                </dxc:XYDiagram2D.NavigationOptions>

                                <!-- AxisX -->
                                <dxc:XYDiagram2D.AxisX>
                                    <dxc:AxisX2D>
                                        <!--<dxc:AxisX2D.Label>
                                            <dxc:AxisLabel TextPattern="{}{A:HH:mm:ss}"/>
                                        </dxc:AxisX2D.Label>-->

                                        <dxc:AxisX2D.VisualRange>
                                            <dxc:Range AutoSideMargins="False" SideMarginsValue="0"
                                                MinValue="{Binding DataContext.AxisXMin, RelativeSource={RelativeSource AncestorType=Window}}"
                                                MaxValue="{Binding DataContext.AxisXMax, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                        </dxc:AxisX2D.VisualRange>

                                        <dxc:AxisX2D.WholeRange>
                                            <dxc:Range AutoSideMargins="False" SideMarginsValue="0"
                                                MinValue="{Binding DataContext.AxisXWholeMin, RelativeSource={RelativeSource AncestorType=Window}}"
                                                MaxValue="{Binding DataContext.AxisXWholeMax, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                        </dxc:AxisX2D.WholeRange>

                                        <dxc:AxisX2D.DateTimeScaleOptions>
                                            <dxc:ContinuousDateTimeScaleOptions GridAlignment="Second" AutoGrid="True"/>
                                        </dxc:AxisX2D.DateTimeScaleOptions>

                                    </dxc:AxisX2D>
                                </dxc:XYDiagram2D.AxisX>

                                <!-- AxisY: -->
                                <dxc:XYDiagram2D.AxisY>
                                    <dxc:AxisY2D>
                                        <dxc:AxisY2D.VisualRange>
                                            <dxc:Range AutoSideMargins="False" SideMarginsValue="0"
                                                       MinValue="{Binding DataContext.AxisYMin, RelativeSource={RelativeSource AncestorType=Window}}"
                                                       MaxValue="{Binding DataContext.AxisYMax, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                        </dxc:AxisY2D.VisualRange>
                                        <dxc:AxisY2D.WholeRange>
                                            <dxc:Range AutoSideMargins="False" SideMarginsValue="0"
                                                       MinValue="{Binding DataContext.AxisYMin, RelativeSource={RelativeSource AncestorType=Window}}"
                                                       MaxValue="{Binding DataContext.AxisYMax, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                        </dxc:AxisY2D.WholeRange>
                                    </dxc:AxisY2D>
                                </dxc:XYDiagram2D.AxisY>

                                <!-- ====== Series ====== -->
                                <dxc:XYDiagram2D.SeriesTemplate>
                                    <dxc:SplineAreaSeries2D
                                        ArgumentDataMember="Time"
                                        ValueDataMember="Value"
                                        ArgumentScaleType="DateTime"
                                        MarkerVisible="False"
                                        LineTension="0.0">


                                        <!--ToolTipEnabled="True"
                                        ToolTipHintDataMember="RawValue"
                                        ToolTipPointPattern="{}{S} | {A:HH:mm:ss} = {H:0.###}">-->
                                    </dxc:SplineAreaSeries2D>
                                </dxc:XYDiagram2D.SeriesTemplate>

                            </dxc:XYDiagram2D>
                        </dxc:ChartControl.Diagram>
                    </dxc:ChartControl>

                </dxlc:LayoutItem>

                <!-- ====== SETTINGS (PLC / Chanel / Alarm) ====== -->
                <dxlc:LayoutItem Visibility="{Binding DataContext.IsParamSettingsVisible, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BoolToVis}}">
                    
                    <!-- вложенный LayoutControl, чтобы можно было показывать/скрывать целиком -->
                    <dxlc:LayoutControl Margin="-12">
                        
                        <dxlc:LayoutGroup Orientation="Vertical" View="Group" GroupBoxDisplayMode="Light">

                            <!-- ====== твой блок PLC Settings ====== -->
                            <dxlc:LayoutGroup Header="PLC settings" View="GroupBox" HorizontalAlignment="Stretch" Orientation="Vertical">

                                <dxlc:LayoutItem Label="Max">
                                    <dxe:TextEdit
                                        Tag="Max"
                                        Width="80" HorizontalAlignment="Right"
                                        EditValue="{Binding Max, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                        Style="{StaticResource AppBaseEditStyle}"
                                        PreviewKeyDown="ParamEditable_EditValueChanged"/>
                                </dxlc:LayoutItem>

                                <dxlc:LayoutItem Label="Min">
                                    <dxe:TextEdit
                                        Tag="Min"
                                        Width="80" HorizontalAlignment="Right"
                                        EditValue="{Binding Min, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                        Style="{StaticResource AppBaseEditStyle}"
                                        PreviewKeyDown="ParamEditable_EditValueChanged"/>
                                </dxlc:LayoutItem>

                                <dxlc:LayoutItem Label="Filtration">
                                    <dxe:TextEdit
                                        Tag="Flt"
                                        Width="80" HorizontalAlignment="Right"
                                        EditValue="{Binding Flt, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                        Style="{StaticResource AppBaseEditStyle}"
                                        PreviewKeyDown="ParamEditable_EditValueChanged"/>
                                </dxlc:LayoutItem>

                            </dxlc:LayoutGroup>

                            <!-- ====== твой блок Chanel Settings ====== -->
                            <dxlc:LayoutGroup Header="Chanel settings" View="GroupBox" HorizontalAlignment="Stretch" Orientation="Vertical">

                                <dxlc:LayoutItem Label="MaxR">
                                    <dxe:TextEdit
                                            Tag="MaxR"
                                            Width="80" HorizontalAlignment="Right"
                                            EditValue="{Binding MaxR, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                            Style="{StaticResource AppBaseEditStyle}"
                                            PreviewKeyDown="ParamEditable_EditValueChanged"/>
                                </dxlc:LayoutItem>

                                <dxlc:LayoutItem Label="MinR">
                                    <dxe:TextEdit
                                            Tag="MinR"
                                            Width="80" HorizontalAlignment="Right"
                                            EditValue="{Binding MinR, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                            Style="{StaticResource AppBaseEditStyle}"
                                            PreviewKeyDown="ParamEditable_EditValueChanged"/>
                                </dxlc:LayoutItem>

                                <dxlc:LayoutItem Label="Coefficient">
                                    <dxe:TextEdit
                                            Tag="Coef"
                                            Width="80" HorizontalAlignment="Right"
                                            EditValue="{Binding Coef, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                            Style="{StaticResource AppBaseEditStyle}"
                                            PreviewKeyDown="ParamEditable_EditValueChanged"/>
                                </dxlc:LayoutItem>

                            </dxlc:LayoutGroup>

                            <!-- ====== твой Alarm settings ====== -->
                            <dxlc:LayoutGroup Header="Alarm settings" View="GroupBox" HorizontalAlignment="Stretch" Orientation="Vertical">
                                
                                 <!--HA-->
                                <dxlc:LayoutGroup Orientation="Horizontal">
                                    <dxlc:LayoutItem Style="{StaticResource BoolCheckLayoutItemStyle}">
                                        <dxe:CheckEdit Style="{StaticResource BoolParamCheckEditStyle}"
                                                       Tag="AlarmHAEn"
                                                       IsChecked="{Binding AlarmHAEn}"
                                                       EditValueChanged="ParamEditable_EditValueChanged"/>
                                    </dxlc:LayoutItem>

                                    <dxlc:LayoutItem Label="HA" HorizontalAlignment="Right">
                                        <dxe:TextEdit Tag="SetHA"
                                            Width="80" HorizontalAlignment="Left"
                                            EditValue="{Binding SetHA, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                            Style="{StaticResource AppBaseEditStyle}"
                                            PreviewKeyDown="ParamEditable_EditValueChanged"/>
                                    </dxlc:LayoutItem>
                                </dxlc:LayoutGroup>

                                 <!--HW--> 
                                <dxlc:LayoutGroup Orientation="Horizontal">
                                    <dxlc:LayoutItem Style="{StaticResource BoolCheckLayoutItemStyle}">
                                        <dxe:CheckEdit Style="{StaticResource BoolParamCheckEditStyle}"
                                                       Tag="AlarmHWEn"
                                                       IsChecked="{Binding AlarmHWEn}"
                                                       EditValueChanged="ParamEditable_EditValueChanged"/>
                                    </dxlc:LayoutItem>

                                    <dxlc:LayoutItem Label="HW" HorizontalAlignment="Right">
                                        <dxe:TextEdit Tag="SetHW"
                                                Width="80" HorizontalAlignment="Left"
                                                EditValue="{Binding SetHW, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                                Style="{StaticResource AppBaseEditStyle}"
                                                PreviewKeyDown="ParamEditable_EditValueChanged"/>
                                    </dxlc:LayoutItem>
                                </dxlc:LayoutGroup>

                                 <!--LW-->
                                <dxlc:LayoutGroup Orientation="Horizontal">
                                    <dxlc:LayoutItem Style="{StaticResource BoolCheckLayoutItemStyle}">
                                        <dxe:CheckEdit Style="{StaticResource BoolParamCheckEditStyle}"
                                            Tag="AlarmLWEn"
                                            IsChecked="{Binding AlarmLWEn}"
                                            EditValueChanged="ParamEditable_EditValueChanged"/>
                                    </dxlc:LayoutItem>

                                    <dxlc:LayoutItem Label="LW" HorizontalAlignment="Right">
                                        <dxe:TextEdit Tag="SetLW"
                                            Width="80" HorizontalAlignment="Left"
                                            EditValue="{Binding SetLW, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                            Style="{StaticResource AppBaseEditStyle}"
                                            PreviewKeyDown="ParamEditable_EditValueChanged"/>
                                    </dxlc:LayoutItem>
                                </dxlc:LayoutGroup>

                                <!--LA-->
                                <dxlc:LayoutGroup Orientation="Horizontal">
                                    <dxlc:LayoutItem Style="{StaticResource BoolCheckLayoutItemStyle}">
                                        <dxe:CheckEdit Style="{StaticResource BoolParamCheckEditStyle}"
                                                       Tag="AlarmLAEn"
                                                       IsChecked="{Binding AlarmLAEn}"
                                                       EditValueChanged="ParamEditable_EditValueChanged"/>
                                    </dxlc:LayoutItem>

                                    <dxlc:LayoutItem Label="LA" HorizontalAlignment="Right">
                                        <dxe:TextEdit Tag="SetLA"
                                                Width="80" HorizontalAlignment="Left"
                                                EditValue="{Binding SetLA, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                                Style="{StaticResource AppBaseEditStyle}"
                                                PreviewKeyDown="ParamEditable_EditValueChanged"/>
                                    </dxlc:LayoutItem>
                                </dxlc:LayoutGroup>

                                <!--HYSTERESIS-->
                                <dxlc:LayoutGroup Orientation="Horizontal">
                                    <dxlc:LayoutItem Label="Hysteresis">
                                        <dxe:TextEdit Tag="SetHyst"
                                            Width="80" HorizontalAlignment="Right"
                                            EditValue="{Binding SetHyst, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                            Style="{StaticResource AppBaseEditStyle}"
                                            PreviewKeyDown="ParamEditable_EditValueChanged"/>
                                    </dxlc:LayoutItem>
                                </dxlc:LayoutGroup>


                            </dxlc:LayoutGroup>

                        </dxlc:LayoutGroup>
                        
                    </dxlc:LayoutControl>
                    
                </dxlc:LayoutItem>

            </dxlc:LayoutGroup>

            <!-- ================= RIGHT BLOCK (buttons) ================= -->

            <dxlc:LayoutGroup View="Group" GroupBoxDisplayMode="Light" Header="" HorizontalAlignment="Right">
                <StackPanel Orientation="Vertical" VerticalAlignment="Top">
                    <dx:SimpleButton Content="G" Height="60" Width="60"
                         Style="{StaticResource AppButtonStyle}"
                         Click="ShowChartButton_Click"/>
                    <dx:SimpleButton Content="P" Height="60" Width="60" Margin="0,8,0,0"
                         Style="{StaticResource AppButtonStyle}"
                         Click="ShowParamsButton_Click"/>
                    <!-- Live: вернуть график к режиму "приклеен к текущему времени" -->
                    <dx:SimpleButton Content="Live" Height="60" Width="60" Margin="0,108,0,0" VerticalAlignment="Bottom"
                        Style="{StaticResource AppButtonStyle}"
                        Click="LiveButton_Click"/>
                </StackPanel>
            </dxlc:LayoutGroup>

        </dxlc:LayoutGroup>

    </dxlc:LayoutControl>

</UserControl>